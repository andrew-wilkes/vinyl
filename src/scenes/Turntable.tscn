[gd_scene load_steps=23 format=2]

[ext_resource path="res://scenes/Navigation.tscn" type="PackedScene" id=1]
[ext_resource path="res://assets/heading1.tres" type="DynamicFont" id=2]
[ext_resource path="res://assets/heading2.tres" type="DynamicFont" id=3]
[ext_resource path="res://assets/UI.theme" type="Theme" id=4]
[ext_resource path="res://scenes/OrbitCamera.tscn" type="PackedScene" id=5]
[ext_resource path="res://assets/regular.tres" type="DynamicFont" id=6]
[ext_resource path="res://scenes/Turntable.gd" type="Script" id=7]
[ext_resource path="res://assets/turntable.glb" type="PackedScene" id=8]
[ext_resource path="res://assets/eject-record.png" type="Texture" id=9]
[ext_resource path="res://assets/play-record.png" type="Texture" id=10]
[ext_resource path="res://scenes/Record.tscn" type="PackedScene" id=11]
[ext_resource path="res://assets/rec33rpm.obj" type="ArrayMesh" id=12]
[ext_resource path="res://assets/checkerboard.png" type="Texture" id=13]
[ext_resource path="res://assets/tracks-button.png" type="Texture" id=14]
[ext_resource path="res://assets/highlight-shader.tres" type="Shader" id=15]

[sub_resource type="CylinderShape" id=1]
height = 0.19
radius = 0.028

[sub_resource type="BoxShape" id=2]
extents = Vector3( 0.01, 0.1, 0.025 )

[sub_resource type="CylinderShape" id=3]
height = 0.18
radius = 0.15

[sub_resource type="ShaderMaterial" id=7]
shader = ExtResource( 15 )
shader_param/Level = null

[sub_resource type="Shader" id=4]
code = "shader_type spatial;

uniform float num_rings = 32;
uniform float rmax = 0.95;
uniform float rmin = 0.4;
uniform float label_radius = 0.3;
uniform sampler2D label_a;
uniform sampler2D label_b;
uniform float inner_smoothing = 30.0;
uniform float outer_smoothing = 10.0;
uniform float alphav = 1.0;

const float PI = 3.14159265358979323846;

void fragment() {
	if (UV.y < 0.5) {
		ALBEDO = vec3(0.0);
	} else {
		float thickness = 0.5;
		vec4 col = COLOR;
		// Get point in bottom 2 square areas
		vec2 pt = vec2(fract(UV.x * 2.0), (UV.y - 0.5) * 2.0);
		pt = 2.0 * (pt - vec2(0.5)); // 0,0 .. +/-1,+/-1
		float ang = atan(-pt.y / pt.x); // +PI .. -PI
		float dr = 0.5 / num_rings;
		float pr = length(pt);
		float radius = pr + dr * (0.5 + ang / PI); // radius of the point on a spiral
		if (pt.x < 0.0) radius += dr;
		float pos_in_band = fract(radius * num_rings); // 0 .. 1
		if (pr < label_radius) {
			// Display label
			if (UV.x < 0.5)
				ALBEDO = texture(label_a, pt / label_radius / 2.0 + vec2(0.5)).rgb;
			else
				ALBEDO = texture(label_b, pt / label_radius / 2.0 + vec2(0.5)).rgb;
			// Smooth edge
			ALBEDO *= clamp((label_radius - pr) * inner_smoothing, 0.0, 1.0);
		} else {
			if (pr < rmax) {
				if (pos_in_band > thickness + fract(sin(ang * 1000.0)) * 0.2 && radius > rmin)
					ALBEDO.rgb = vec3(0.02);
				else {
					ALBEDO = vec3(0.0);
				}
			} else {
				// Outside
				ALBEDO = vec3(0.0);
				// Smooth edge
				ALPHA = clamp((1.0 - pr) * outer_smoothing, 0.0, 1.0);
			}
		}
	}
	ALPHA *= alphav;
}"

[sub_resource type="ShaderMaterial" id=5]
next_pass = SubResource( 7 )
shader = SubResource( 4 )
shader_param/num_rings = 100.0
shader_param/rmax = 0.95
shader_param/rmin = 0.4
shader_param/label_radius = 0.3
shader_param/inner_smoothing = 30.0
shader_param/outer_smoothing = 10.0
shader_param/alphav = 0.0
shader_param/label_a = ExtResource( 14 )
shader_param/label_b = ExtResource( 13 )

[sub_resource type="CylinderShape" id=6]
height = 0.003
radius = 0.148

[node name="Turntable" type="Spatial"]
script = ExtResource( 7 )

[node name="deck" parent="." instance=ExtResource( 8 )]
transform = Transform( -1, 0, 8.74228e-08, 0, 1, 0, -8.74228e-08, 0, -1, 0, 0, 0 )

[node name="OrbitCamera" parent="." instance=ExtResource( 5 )]

[node name="XAxis" parent="OrbitCamera/YAxis" index="0"]
transform = Transform( 1, 0, 0, 0, 0.816229, 0.57773, 0, -0.57773, 0.816229, 0, 0, 0 )

[node name="Camera" parent="OrbitCamera/YAxis/XAxis" index="0"]
transform = Transform( 1, 0, 0, 0, 1, 3.72529e-09, 0, 0, 1, 0, -0.073812, 5.28605 )
visible = false

[node name="DirectionalLight" parent="OrbitCamera/YAxis/XAxis" index="1"]
transform = Transform( 0.183247, 0.971622, 0.14957, -0.956496, 0.141084, 0.255363, 0.227014, -0.189857, 0.955205, 0, 0, 0 )
visible = true
light_energy = 1.879

[node name="DirectionalLight2" parent="OrbitCamera/YAxis/XAxis" index="2"]
transform = Transform( 0.967362, 0.165005, 0.192312, 0.088716, 0.490364, -0.86699, -0.237361, 0.855755, 0.45972, 3.95064, 8.27146, -0.530499 )
visible = true
light_specular = 0.013

[node name="LeverArea" type="Area" parent="."]

[node name="CollisionShape" type="CollisionShape" parent="LeverArea"]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0 )
shape = SubResource( 1 )

[node name="HandleArea" type="Area" parent="."]

[node name="CollisionShape" type="CollisionShape" parent="HandleArea"]
shape = SubResource( 2 )

[node name="SwitchArea" type="Area" parent="."]

[node name="CollisionShape" type="CollisionShape" parent="SwitchArea"]
shape = SubResource( 3 )

[node name="c" type="CanvasLayer" parent="."]

[node name="M" type="MarginContainer" parent="c"]
margin_right = 729.0
margin_bottom = 680.0
mouse_filter = 2
theme = ExtResource( 4 )
custom_constants/margin_right = 20
custom_constants/margin_top = 20
custom_constants/margin_left = 20
custom_constants/margin_bottom = 20

[node name="VB" type="VBoxContainer" parent="c/M"]
margin_left = 20.0
margin_top = 20.0
margin_right = 709.0
margin_bottom = 660.0
mouse_filter = 2
custom_constants/separation = 20

[node name="HB" type="HBoxContainer" parent="c/M/VB"]
margin_right = 689.0
margin_bottom = 97.0
custom_constants/separation = 20

[node name="Label" type="Label" parent="c/M/VB/HB"]
margin_top = 31.0
margin_right = 165.0
margin_bottom = 65.0
custom_fonts/font = ExtResource( 2 )
text = "Record Player"

[node name="Navigation" parent="c/M/VB/HB" instance=ExtResource( 1 )]
margin_left = 185.0
margin_right = 689.0
margin_bottom = 97.0
current_selection = 4

[node name="HB2" type="HBoxContainer" parent="c/M/VB"]
margin_top = 117.0
margin_right = 689.0
margin_bottom = 479.0
mouse_filter = 2

[node name="Details" type="PanelContainer" parent="c/M/VB/HB2"]
unique_name_in_owner = true
margin_right = 342.0
margin_bottom = 362.0
mouse_filter = 2
size_flags_horizontal = 3

[node name="Items" type="VBoxContainer" parent="c/M/VB/HB2/Details"]
margin_left = 10.0
margin_top = 10.0
margin_right = 332.0
margin_bottom = 352.0
mouse_filter = 2
size_flags_horizontal = 3
custom_constants/separation = 10

[node name="Label" type="Label" parent="c/M/VB/HB2/Details/Items"]
margin_right = 322.0
margin_bottom = 23.0
custom_fonts/font = ExtResource( 3 )
text = "Album Title"

[node name="Title" type="Label" parent="c/M/VB/HB2/Details/Items"]
unique_name_in_owner = true
margin_top = 33.0
margin_right = 322.0
margin_bottom = 56.0
custom_fonts/font = ExtResource( 6 )

[node name="Label2" type="Label" parent="c/M/VB/HB2/Details/Items"]
margin_top = 66.0
margin_right = 322.0
margin_bottom = 89.0
custom_fonts/font = ExtResource( 3 )
text = "Band / Artist"

[node name="Band" type="Label" parent="c/M/VB/HB2/Details/Items"]
unique_name_in_owner = true
margin_top = 99.0
margin_right = 322.0
margin_bottom = 122.0
custom_fonts/font = ExtResource( 6 )

[node name="HB" type="HBoxContainer" parent="c/M/VB/HB2/Details/Items"]
margin_top = 132.0
margin_right = 322.0
margin_bottom = 171.0
custom_constants/separation = 20

[node name="HSlider" type="HSlider" parent="c/M/VB/HB2/Details/Items/HB"]
unique_name_in_owner = true
margin_right = 222.0
margin_bottom = 16.0
rect_min_size = Vector2( 50, 0 )
size_flags_horizontal = 3
value = 30.0

[node name="Play" type="Button" parent="c/M/VB/HB2/Details/Items/HB"]
unique_name_in_owner = true
margin_left = 242.0
margin_right = 272.0
margin_bottom = 39.0
hint_tooltip = "Play"
icon = ExtResource( 10 )

[node name="Eject" type="Button" parent="c/M/VB/HB2/Details/Items/HB"]
unique_name_in_owner = true
margin_left = 292.0
margin_right = 322.0
margin_bottom = 39.0
hint_tooltip = "Eject"
icon = ExtResource( 9 )

[node name="VPC" type="ViewportContainer" parent="c/M/VB/HB2/Details/Items"]
margin_top = 181.0
margin_right = 322.0
margin_bottom = 342.0
rect_min_size = Vector2( 0, 160 )

[node name="Viewport" type="Viewport" parent="c/M/VB/HB2/Details/Items/VPC"]
size = Vector2( 322, 161 )
own_world = true
handle_input_locally = false
render_target_update_mode = 3

[node name="Record" parent="c/M/VB/HB2/Details/Items/VPC/Viewport" instance=ExtResource( 11 )]
unique_name_in_owner = true

[node name="Control" type="Control" parent="c/M/VB/HB2"]
margin_left = 346.0
margin_right = 689.0
margin_bottom = 362.0
mouse_filter = 2
size_flags_horizontal = 3

[node name="Disc" type="MeshInstance" parent="."]
transform = Transform( 10, 0, 0, 0, 10, 0, 0, 0, 10, 0, 0.145, 0 )
mesh = ExtResource( 12 )
material/0 = SubResource( 5 )

[node name="Area" type="Area" parent="Disc"]
visible = false

[node name="CollisionShape" type="CollisionShape" parent="Disc/Area"]
shape = SubResource( 6 )

[connection signal="input_event" from="LeverArea" to="." method="_on_Lever_input_event"]
[connection signal="mouse_entered" from="LeverArea" to="." method="_on_Lever_mouse_entered"]
[connection signal="mouse_exited" from="LeverArea" to="." method="_on_Lever_mouse_exited"]
[connection signal="input_event" from="HandleArea" to="." method="_on_HandleArea_input_event"]
[connection signal="mouse_entered" from="HandleArea" to="." method="_on_HandleArea_mouse_entered"]
[connection signal="mouse_exited" from="HandleArea" to="." method="_on_HandleArea_mouse_exited"]
[connection signal="input_event" from="SwitchArea" to="." method="_on_SwitchArea_input_event"]
[connection signal="mouse_entered" from="SwitchArea" to="." method="_on_SwitchArea_mouse_entered"]
[connection signal="mouse_exited" from="SwitchArea" to="." method="_on_SwitchArea_mouse_exited"]
[connection signal="pressed" from="c/M/VB/HB2/Details/Items/HB/Play" to="." method="_on_Play_pressed"]
[connection signal="pressed" from="c/M/VB/HB2/Details/Items/HB/Eject" to="." method="_on_Eject_pressed"]
[connection signal="input_event" from="Disc/Area" to="." method="_on_disc_input_event"]
[connection signal="mouse_entered" from="Disc/Area" to="." method="_on_disc_mouse_entered"]
[connection signal="mouse_exited" from="Disc/Area" to="." method="_on_disc_mouse_exited"]

[editable path="OrbitCamera"]
